{% extends "layout.html" %}

{% block title %}Chat History{% endblock %}
{% block header %}Chat History{% endblock %}
{% block description %}Your past conversations with ElectronicAI{% endblock %}

{% block content %}
<main class="flex-grow-1 d-flex justify-content-center align-items-start">
    <section class="card shadow w-100 p-4"
        style="max-width: 700px; height: 60vh; display: flex; flex-direction: column;">
        <div class="d-flex justify-content-center align-items-center mb-4 gap-2">
            <form method="POST" action="{{ url_for('clear_history') }}" class="mb-0">
                <button type="submit" class="btn btn-danger">Clear History</button>
            </form>
        </div>
        {% if messages %}
        <div class="list-group flex-grow-1 overflow-auto mb-3" style="min-height: 0;">
            {% for message in messages %}
            <div class="list-group-item history-message {{ message.role }}">
                <div class="history-message-body" data-role="{{ message.role }}">
                    <strong class="text-capitalize">{{ message.role }}:</strong>
                    <span class="markdown-content">{{ message.message }}</span>
                </div>
                <div class="message-meta text-muted small">Message ID: {{ message.id }}</div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p
            class="no-messages text-center text-muted flex-grow-1 d-flex align-items-center justify-content-center mb-0">
            No chat history found.</p>
        {% endif %}
    </section>
</main>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.markdown-content').forEach(function (el) {
            el.innerHTML = marked.parse(el.textContent);
        });
    });
</script>
{% endblock %}